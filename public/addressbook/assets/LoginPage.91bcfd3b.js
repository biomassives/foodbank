import{d as f,Q as c,e as V}from"./QCard.8af1a0ba.js";import{D as b,r as n,ay as w,F as d,G as x,H as r,I as a,aa as v,au as p,K as m}from"./index.f356d913.js";import{Q as B}from"./QPage.77997d05.js";import{u as _,s as g}from"./store.3d666953.js";const Q={key:0},P={key:1},A=b({__name:"LoginPage",setup(I){const s=n(""),u=n(""),i=n(!1),l=n(!1),y=w(),k=_();async function h(){l.value=!0;const{error:t}=await g.auth.signInWithOtp({phone:s.value});t?alert(t.message):i.value=!0,l.value=!1}async function C(){l.value=!0;const{error:t}=await g.auth.verifyOtp({phone:s.value,token:u.value,type:"sms"});t?alert(t.message):(await k.fetchUserRole(),y.push("/")),l.value=!1}return(t,e)=>(d(),x(B,{class:"flex flex-center bg-grey-2"},{default:r(()=>[a(V,{style:{width:"400px","max-width":"90vw"}},{default:r(()=>[a(f,{class:"text-center"},{default:r(()=>[...e[3]||(e[3]=[v("div",{class:"text-h6"},"Biodiversity Address Book",-1),v("div",{class:"text-subtitle2"},"Identity & Access Management",-1)])]),_:1}),a(f,null,{default:r(()=>[i.value?(d(),p("div",P,[a(c,{modelValue:u.value,"onUpdate:modelValue":e[1]||(e[1]=o=>u.value=o),label:"Verification Code",mask:"######"},null,8,["modelValue"]),a(m,{label:"Verify & Login",color:"secondary",class:"full-width q-mt-md",onClick:C,loading:l.value},null,8,["loading"]),a(m,{flat:"",label:"Back",class:"full-width q-mt-sm",onClick:e[2]||(e[2]=o=>i.value=!1)})])):(d(),p("div",Q,[a(c,{modelValue:s.value,"onUpdate:modelValue":e[0]||(e[0]=o=>s.value=o),label:"Phone Number (e.g. +123456789)",mask:"+############",hint:"Format: +CountryCode Number"},null,8,["modelValue"]),a(m,{label:"Send Verification Code",color:"primary",class:"full-width q-mt-md",onClick:h,loading:l.value},null,8,["loading"])]))]),_:1})]),_:1})]),_:1}))}});export{A as default};
