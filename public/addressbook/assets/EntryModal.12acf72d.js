import{y as ie,r as v,o as ve,d as pe,A as f,N as k,D as o,R as H,S as q,T as le,H as O,E as i,Q as y,n as me,U as A,_ as ue,z as fe,V as ye,a as E,w as ne,B as j,C as se,f as ee,W as R,F as B,O as G,G as he,X as ge}from"./index.86fc262c.js";import{Q as U}from"./QInput.00be970d.js";import{Q as ke}from"./QSpace.0e75fa89.js";import{Q as _e}from"./QToggle.5286364e.js";import{Q as be,f as Ce,C as te}from"./ClosePopup.0a1e2cc5.js";import{b as we}from"./use-quasar.00d2e197.js";const xe={class:"sketch-wrap"},Se={class:"sketch-canvas-frame"},Ve={class:"sketch-toolbar"},ze={class:"sketch-colors"},Te=["onClick"],De={class:"sketch-widths"},Re=["onClick"],$e=["disabled"],Pe=["disabled"],Ee=ie({__name:"SketchPad",emits:["update:modelValue"],setup(ae,{expose:K,emit:N}){const $=N,m=v(null),c=v([]),w=v(!1),I=v("#fff"),d=v(3),_=v(!1),x=["#fff","#fdd835","#69f0ae","#82b1ff","#ef5350","#ffab40"],T=[{size:2},{size:4},{size:8}];let a=null,b=1;function S(){const s=m.value;if(!s)return;const u=s.getBoundingClientRect();b=window.devicePixelRatio||1,s.width=u.width*b,s.height=u.height*b,a=s.getContext("2d"),a&&a.scale(b,b),V()}function h(s){const u=m.value.getBoundingClientRect();let t,r;if("touches"in s&&s.touches.length)t=s.touches[0].clientX,r=s.touches[0].clientY;else if("clientX"in s)t=s.clientX,r=s.clientY;else return{x:0,y:0};return{x:t-u.left,y:r-u.top}}function g(s){w.value=!0;const u=h(s);c.value.push({points:[u],color:I.value,width:d.value})}function D(s){if(!w.value||!a)return;const u=h(s),t=c.value[c.value.length-1];t.points.push(u),F(t)}function C(){!w.value||(w.value=!1,Q())}function F(s){if(!a)return;const u=s.points,t=u.length;if(!(t<2)){if(a.strokeStyle=s.color,a.lineWidth=s.width,a.lineCap="round",a.lineJoin="round",a.beginPath(),t===2)a.moveTo(u[0].x,u[0].y),a.lineTo(u[1].x,u[1].y);else{const r=u[t-3],p=u[t-2],P=u[t-1],L=(p.x+P.x)/2,J=(p.y+P.y)/2;a.moveTo((r.x+p.x)/2,(r.y+p.y)/2),a.quadraticCurveTo(p.x,p.y,L,J)}a.stroke()}}function V(){if(!a||!m.value)return;const s=m.value.getBoundingClientRect().width,u=m.value.getBoundingClientRect().height;if(a.clearRect(0,0,s,u),_.value){a.strokeStyle="rgba(255,255,255,0.06)",a.lineWidth=.5;const t=20;for(let r=t;r<s;r+=t)a.beginPath(),a.moveTo(r,0),a.lineTo(r,u),a.stroke();for(let r=t;r<u;r+=t)a.beginPath(),a.moveTo(0,r),a.lineTo(s,r),a.stroke()}for(const t of c.value){if(t.points.length<2)continue;a.strokeStyle=t.color,a.lineWidth=t.width,a.lineCap="round",a.lineJoin="round",a.beginPath(),a.moveTo(t.points[0].x,t.points[0].y);for(let p=1;p<t.points.length-1;p++){const P=(t.points[p].x+t.points[p+1].x)/2,L=(t.points[p].y+t.points[p+1].y)/2;a.quadraticCurveTo(t.points[p].x,t.points[p].y,P,L)}const r=t.points[t.points.length-1];a.lineTo(r.x,r.y),a.stroke()}}function X(){c.value.pop(),V(),Q()}function W(){c.value=[],V(),Q()}function Y(){_.value=!_.value,V()}function Q(){if(!!m.value){if(c.value.length===0){$("update:modelValue","");return}$("update:modelValue",m.value.toDataURL("image/png"))}}function Z(){c.value=[],me(()=>V())}let z=null;return ve(()=>{S(),z=new ResizeObserver(()=>{S()}),m.value&&z.observe(m.value)}),pe(()=>{z==null||z.disconnect()}),K({reset:Z}),(s,u)=>(f(),k("div",xe,[o("div",Se,[o("canvas",{ref_key:"canvasEl",ref:m,class:"sketch-canvas",onMousedown:g,onMousemove:D,onMouseup:C,onMouseleave:C,onTouchstart:H(g,["prevent"]),onTouchmove:H(D,["prevent"]),onTouchend:C},null,544)]),o("div",Ve,[o("div",ze,[(f(),k(q,null,le(x,t=>o("button",{key:t,class:O(["sketch-swatch",{active:I.value===t}]),style:A({background:t}),onClick:r=>I.value=t},null,14,Te)),64))]),o("div",De,[(f(),k(q,null,le(T,t=>o("button",{key:t.size,class:O(["sketch-width-btn",{active:d.value===t.size}]),onClick:r=>d.value=t.size},[o("span",{class:"sketch-width-dot",style:A({width:t.size+"px",height:t.size+"px"})},null,4)],10,Re)),64))]),u[0]||(u[0]=o("div",{class:"sketch-sep"},null,-1)),o("button",{class:O(["sketch-tool-btn",{active:_.value}]),onClick:Y},[i(y,{name:"grid_on",size:"14px"})],2),o("button",{class:"sketch-tool-btn",disabled:c.value.length===0,onClick:X},[i(y,{name:"undo",size:"14px"})],8,$e),o("button",{class:"sketch-tool-btn",disabled:c.value.length===0,onClick:W},[i(y,{name:"delete_outline",size:"14px"})],8,Pe)])]))}});var Ue=ue(Ee,[["__scopeId","data-v-6980e2fa"]]);const qe={class:"modal-header"},Ne={class:"modal-body"},Ie=["onClick"],Qe={class:"type-row-text"},Le={class:"type-row-label"},Me={class:"type-row-caption"},Be={class:"modal-header"},Oe={class:"modal-body"},Ae={class:"row q-col-gutter-sm"},Fe={class:"row q-col-gutter-sm q-mt-xs"},We={class:"sync-bar q-mt-md"},Ge={class:"modal-actions"},He={class:"modal-header"},Ke={class:"modal-header-label"},Xe={class:"modal-body modal-body--scroll"},Ye={class:"attach-tabs"},Ze={key:1,class:"attach-area"},Je={key:2,class:"attach-area"},je={key:1,class:"upload-preview"},et=["src"],tt={class:"sync-bar q-mt-md"},lt={class:"modal-actions"},at=ie({__name:"EntryModal",props:{cardState:{type:Boolean},initialType:{}},emits:["update:cardState"],setup(ae,{emit:K}){const N=ae,$=K,m=we(),c=fe(),w=v(!1),I=ye(N,"cardState"),d=v(null),_=v(""),x=v(""),T=v(""),a=v(""),b=v(""),S=v(""),h=v(!0),g=v(null),D=v(""),C=v(null),F=v(null),V=v(null),X=/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/,W=[l=>l&&l.length>0||"Required",l=>l&&l.length>=3||"3 or more characters",l=>l&&/^[a-z]+$/gi.test(l)||"Letters only"],Y=[l=>l&&X.test(l)||"Invalid email"],Q=[()=>a.value.replace(/[-()\s]/g,"").length>=10||"Invalid phone"],Z=E(()=>{const l=[{type:"contact",icon:"person_add",color:"#82b1ff",label:"Contact",caption:"Save to address book"},{type:"need",icon:"volunteer_activism",color:"#ef5350",label:"Need",caption:"Request an item or resource"},{type:"offering",icon:"card_giftcard",color:"#69f0ae",label:"Offering",caption:"Share what you have"},{type:"looking_for",icon:"search",color:"#ce93d8",label:"Looking For",caption:"Something you're searching for"},{type:"upcoming_need",icon:"event",color:"#80cbc4",label:"Upcoming Need",caption:"Plan ahead"}];return c.canEdit&&l.push({type:"pickup_queue",icon:"local_shipping",color:"#ffab40",label:"Pickup Queue",caption:"Create a pickup task"}),l}),z={need:{label:"NEED",icon:"volunteer_activism"},offering:{label:"OFFERING",icon:"card_giftcard"},pickup_queue:{label:"PICKUP QUEUE",icon:"local_shipping"},looking_for:{label:"LOOKING FOR",icon:"search"},upcoming_need:{label:"UPCOMING NEED",icon:"event"}},s=E(()=>{var l;return d.value&&d.value!=="contact"&&((l=z[d.value])==null?void 0:l.label)||""}),u=E(()=>{var l;return d.value&&d.value!=="contact"&&((l=z[d.value])==null?void 0:l.icon)||""}),t=E(()=>c.canSync?"cloud_done":c.localMode?"smartphone":"save"),r=E(()=>c.canSync?"#69f0ae":c.localMode?"#82b1ff":"rgba(255,255,255,0.4)"),p=E(()=>c.canSync&&h.value?"Saves locally + syncs to pantry":c.canSync&&!h.value?"Saves locally only":c.localMode?"Saves to your browser":"Saves locally");function P(){var l;(l=V.value)==null||l.click()}function L(l){var n;const e=(n=l.target.files)==null?void 0:n[0];!e||oe(e)}function J(l){var n,M;const e=(M=(n=l.dataTransfer)==null?void 0:n.files)==null?void 0:M[0];e&&e.type.startsWith("image/")&&oe(e)}function oe(l){if(l.size>512e3){m.notify({type:"warning",message:"Image too large (max 500KB). Try a smaller file."});return}const e=new FileReader;e.onload=()=>{C.value=e.result},e.readAsDataURL(l)}ne(I,l=>{w.value=l,l&&N.initialType&&(d.value=N.initialType)}),ne(w,l=>{$("update:cardState",l),l||ce()});function ce(){var l;d.value=null,_.value="",x.value="",T.value="",a.value="",b.value="",S.value="",h.value=!0,g.value=null,D.value="",C.value=null,(l=F.value)==null||l.reset()}async function re(){if(!ge({firstName:_.value,lastName:x.value,email:T.value,phone:a.value})){m.notify({type:"negative",position:"top",message:"Please check all fields."});return}const l=_.value[0].toUpperCase()+_.value.slice(1),e=x.value[0].toUpperCase()+x.value.slice(1),n={id:"",name:{first:l,last:e},email:T.value,phone:a.value};await c.addData(n,c.canSync);const M=c.canSync?"Saved locally + synced":"Saved locally";m.notify({color:"positive",message:`Contact saved. ${M}.`}),$("update:cardState",!1)}async function de(){if(!b.value.trim()){m.notify({type:"negative",position:"top",message:"Description is required."});return}if(d.value==="pickup_queue"&&!S.value.trim()){m.notify({type:"negative",position:"top",message:"Location is required."});return}const l={id:"",type:d.value,description:b.value.trim(),location:d.value==="pickup_queue"?S.value.trim():void 0,status:"active",createdAt:new Date().toISOString(),syncedToCloud:h.value&&c.canSync,sketch:D.value||void 0,image:C.value||void 0};await c.addEntry(l,h.value);const e=h.value&&c.canSync?"Saved + synced":"Saved locally";m.notify({color:"positive",message:`${e}.`}),$("update:cardState",!1)}return(l,e)=>(f(),j(be,{modelValue:w.value,"onUpdate:modelValue":e[14]||(e[14]=n=>w.value=n)},{default:se(()=>[i(Ce,{class:"entry-modal"},{default:se(()=>[d.value?d.value==="contact"?(f(),k(q,{key:1},[o("div",Be,[i(R,{flat:"",dense:"",round:"",icon:"arrow_back",color:"white",size:"sm",onClick:e[0]||(e[0]=n=>d.value=null)}),e[16]||(e[16]=o("span",{class:"modal-header-label"},"NEW CONTACT",-1)),i(y,{name:"person_add",size:"18px",color:"white"})]),o("div",Oe,[o("div",Ae,[i(U,{class:"col-6 modal-input",dense:"",filled:"",modelValue:_.value,"onUpdate:modelValue":e[1]||(e[1]=n=>_.value=n),label:"First Name",rules:W,autofocus:"",dark:""},null,8,["modelValue"]),i(U,{class:"col-6 modal-input",dense:"",filled:"",modelValue:x.value,"onUpdate:modelValue":e[2]||(e[2]=n=>x.value=n),label:"Last Name",rules:W,dark:""},null,8,["modelValue"])]),o("div",Fe,[i(U,{class:"col-6 modal-input",dense:"",filled:"",modelValue:T.value,"onUpdate:modelValue":e[3]||(e[3]=n=>T.value=n),label:"E-mail",rules:Y,dark:""},null,8,["modelValue"]),i(U,{class:"col-6 modal-input",dense:"",filled:"",modelValue:a.value,"onUpdate:modelValue":e[4]||(e[4]=n=>a.value=n),label:"Phone",mask:"(###) ### - ####",rules:Q,dark:""},null,8,["modelValue"])]),o("div",We,[i(y,{name:t.value,size:"14px",style:A({color:r.value})},null,8,["name","style"]),o("span",null,B(p.value),1)])]),o("div",Ge,[ee(i(R,{flat:"","no-caps":"",label:"Cancel",class:"modal-btn-flat"},null,512),[[te]]),i(R,{unelevated:"","no-caps":"",label:"Save",class:"modal-btn-save",onClick:re})])],64)):(f(),k(q,{key:2},[o("div",He,[i(R,{flat:"",dense:"",round:"",icon:"arrow_back",color:"white",size:"sm",onClick:e[5]||(e[5]=n=>d.value=null)}),o("span",Ke,B(s.value),1),i(y,{name:u.value,size:"18px",color:"white"},null,8,["name"])]),o("div",Xe,[i(U,{modelValue:b.value,"onUpdate:modelValue":e[6]||(e[6]=n=>b.value=n),type:"textarea",label:"Description",autogrow:"",autofocus:"",filled:"",dense:"",dark:"",class:"modal-input",rules:[n=>!!n||"Required"]},null,8,["modelValue","rules"]),d.value==="pickup_queue"?(f(),j(U,{key:0,modelValue:S.value,"onUpdate:modelValue":e[7]||(e[7]=n=>S.value=n),label:"Pickup Location",filled:"",dense:"",dark:"",class:"modal-input q-mt-sm",rules:[n=>!!n||"Required"]},null,8,["modelValue","rules"])):G("",!0),e[20]||(e[20]=o("div",{class:"attach-label"},"ATTACH",-1)),o("div",Ye,[o("button",{class:O(["attach-tab",{active:g.value==="sketch"}]),onClick:e[8]||(e[8]=n=>g.value=g.value==="sketch"?null:"sketch")},[i(y,{name:"draw",size:"14px"}),e[17]||(e[17]=o("span",null,"SKETCH",-1))],2),o("button",{class:O(["attach-tab",{active:g.value==="photo"}]),onClick:e[9]||(e[9]=n=>g.value=g.value==="photo"?null:"photo")},[i(y,{name:"photo_camera",size:"14px"}),e[18]||(e[18]=o("span",null,"PHOTO",-1))],2)]),g.value==="sketch"?(f(),k("div",Ze,[i(Ue,{ref_key:"sketchPadRef",ref:F,modelValue:D.value,"onUpdate:modelValue":e[10]||(e[10]=n=>D.value=n)},null,8,["modelValue"])])):G("",!0),g.value==="photo"?(f(),k("div",Je,[C.value?(f(),k("div",je,[o("img",{src:C.value,alt:"attached",class:"upload-img"},null,8,et),o("button",{class:"upload-remove",onClick:e[12]||(e[12]=n=>C.value=null)},[i(y,{name:"close",size:"14px"})])])):(f(),k("div",{key:0,class:"upload-zone",onClick:P,onDragover:e[11]||(e[11]=H(()=>{},["prevent"])),onDrop:H(J,["prevent"])},[i(y,{name:"add_photo_alternate",size:"28px"}),e[19]||(e[19]=o("span",null,"Tap to upload or drop an image",-1))],32)),o("input",{ref_key:"fileInput",ref:V,type:"file",accept:"image/*",class:"upload-hidden",onChange:L},null,544)])):G("",!0),o("div",tt,[i(y,{name:t.value,size:"14px",style:A({color:r.value})},null,8,["name","style"]),o("span",null,B(p.value),1),i(ke),he(c).canSync?(f(),j(_e,{key:0,modelValue:h.value,"onUpdate:modelValue":e[13]||(e[13]=n=>h.value=n),dense:"",color:"yellow",size:"sm",label:h.value?"SYNC":"LOCAL",class:"sync-toggle"},null,8,["modelValue","label"])):G("",!0)])]),o("div",lt,[ee(i(R,{flat:"","no-caps":"",label:"Cancel",class:"modal-btn-flat"},null,512),[[te]]),i(R,{unelevated:"","no-caps":"",label:"Save",class:"modal-btn-save",onClick:de})])],64)):(f(),k(q,{key:0},[o("div",qe,[e[15]||(e[15]=o("span",{class:"modal-header-label"},"ADD",-1)),ee(i(R,{flat:"",dense:"",round:"",icon:"close",color:"white",size:"sm"},null,512),[[te]])]),o("div",Ne,[(f(!0),k(q,null,le(Z.value,n=>(f(),k("div",{key:n.type,class:"type-row",onClick:M=>d.value=n.type},[i(y,{name:n.icon,size:"18px",style:A({color:n.color})},null,8,["name","style"]),o("div",Qe,[o("div",Le,B(n.label),1),o("div",Me,B(n.caption),1)]),i(y,{name:"chevron_right",size:"16px",class:"type-row-arrow"})],8,Ie))),128))])],64))]),_:1})]),_:1},8,["modelValue"]))}});var rt=ue(at,[["__scopeId","data-v-ae6c29ce"]]);export{rt as E};
