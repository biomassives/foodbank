import{Q as f}from"./QCardSection.277d7bd0.js";import{Q as c,a as V}from"./QCard.cab38a8e.js";import{G as b,r as n,H as w,I as d,J as x,K as r,L as a,a0 as v,av as p,O as m}from"./index.2b4c1443.js";import{Q as B}from"./QPage.6c8a3c09.js";import{u as Q,s as g}from"./store.768f854b.js";const _={key:0},O={key:1},L=b({__name:"LoginPage",setup(P){const s=n(""),u=n(""),i=n(!1),t=n(!1),y=w(),k=Q();async function h(){t.value=!0;const{error:l}=await g.auth.signInWithOtp({phone:s.value});l?alert(l.message):i.value=!0,t.value=!1}async function C(){t.value=!0;const{error:l}=await g.auth.verifyOtp({phone:s.value,token:u.value,type:"sms"});l?alert(l.message):(await k.fetchUserRole(),y.push("/")),t.value=!1}return(l,e)=>(d(),x(B,{class:"flex flex-center bg-grey-2"},{default:r(()=>[a(V,{style:{width:"400px","max-width":"90vw"}},{default:r(()=>[a(f,{class:"text-center"},{default:r(()=>[...e[3]||(e[3]=[v("div",{class:"text-h6"},"Biodiversity Address Book",-1),v("div",{class:"text-subtitle2"},"Identity & Access Management",-1)])]),_:1}),a(f,null,{default:r(()=>[i.value?(d(),p("div",O,[a(c,{modelValue:u.value,"onUpdate:modelValue":e[1]||(e[1]=o=>u.value=o),label:"Verification Code",mask:"######"},null,8,["modelValue"]),a(m,{label:"Verify & Login",color:"secondary",class:"full-width q-mt-md",onClick:C,loading:t.value},null,8,["loading"]),a(m,{flat:"",label:"Back",class:"full-width q-mt-sm",onClick:e[2]||(e[2]=o=>i.value=!1)})])):(d(),p("div",_,[a(c,{modelValue:s.value,"onUpdate:modelValue":e[0]||(e[0]=o=>s.value=o),label:"Phone Number (e.g. +123456789)",mask:"+############",hint:"Format: +CountryCode Number"},null,8,["modelValue"]),a(m,{label:"Send Verification Code",color:"primary",class:"full-width q-mt-md",onClick:h,loading:t.value},null,8,["loading"])]))]),_:1})]),_:1})]),_:1}))}});export{L as default};
